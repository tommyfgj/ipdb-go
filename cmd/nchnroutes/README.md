# NCHNRoutes å‘½ä»¤è¡Œå·¥å…·

è¿™æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç”Ÿæˆå’ŒéªŒè¯éä¸­å›½å¤§é™†è·¯ç”±é…ç½®ã€‚

## å®‰è£…å’Œä½¿ç”¨

### 1. è¿›å…¥å·¥å…·ç›®å½•

```bash
cd cmd/nchnroutes
```

### 2. ä¸‹è½½ä¾èµ–

```bash
go mod tidy
```

### 3. ä½¿ç”¨æ–¹æ³•

#### ç”ŸæˆBirdé…ç½®æ–‡ä»¶

```bash
# åŸºæœ¬ç”¨æ³•
go run main.go -mode=generate -db=/path/to/city.free.ipdb

# æŒ‡å®šè¾“å‡ºç›®å½•
go run main.go -mode=generate -db=/path/to/city.free.ipdb -output=./my_output/

# å¯ç”¨å¹¶è¡Œå¤„ç†
go run main.go -mode=generate -db=/path/to/city.free.ipdb -parallel

# è‡ªå®šä¹‰å¹¶è¡Œworkeræ•°é‡
go run main.go -mode=generate -db=/path/to/city.free.ipdb -parallel -workers=8
```

#### éªŒè¯ç”Ÿæˆçš„é…ç½®æ–‡ä»¶

```bash
# éªŒè¯é»˜è®¤è·¯å¾„çš„é…ç½®æ–‡ä»¶
go run main.go -mode=validate -db=/path/to/city.free.ipdb

# æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„
go run main.go -mode=validate -db=/path/to/city.free.ipdb -ipv4=./output/bird_v4.conf -ipv6=./output/bird_v6.conf

# è‡ªå®šä¹‰é‡‡æ ·æ•°é‡
go run main.go -mode=validate -db=/path/to/city.free.ipdb -samples=10
```

## å‚æ•°è¯´æ˜

### é€šç”¨å‚æ•°

- `-mode`: è¿è¡Œæ¨¡å¼ï¼Œ`generate`ï¼ˆç”Ÿæˆï¼‰æˆ– `validate`ï¼ˆéªŒè¯ï¼‰
- `-db`: IPDBæ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼ˆå¿…éœ€ï¼‰

### ç”Ÿæˆæ¨¡å¼å‚æ•°

- `-output`: è¾“å‡ºç›®å½•ï¼Œé»˜è®¤ä¸º `./output/`
- `-parallel`: å¯ç”¨å¹¶è¡Œå¤„ç†ï¼Œé»˜è®¤ä¸º `false`
- `-workers`: å¹¶è¡Œworkeræ•°é‡ï¼Œé»˜è®¤ä¸ºCPUæ ¸å¿ƒæ•°

### éªŒè¯æ¨¡å¼å‚æ•°

- `-ipv4`: IPv4é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä¸æŒ‡å®šåˆ™ä½¿ç”¨é»˜è®¤è·¯å¾„ `./output/bird_v4.conf`
- `-ipv6`: IPv6é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œä¸æŒ‡å®šåˆ™ä½¿ç”¨é»˜è®¤è·¯å¾„ `./output/bird_v6.conf`
- `-samples`: æ¯ä¸ªCIDRçš„é‡‡æ ·éªŒè¯æ•°é‡ï¼Œé»˜è®¤ä¸º `5`

## è¾“å‡ºæ–‡ä»¶

ç”Ÿæˆæ¨¡å¼ä¼šåˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š

- `bird_v4.conf` - IPv4 Birdé…ç½®æ–‡ä»¶
- `bird_v6.conf` - IPv6 Birdé…ç½®æ–‡ä»¶

## ç¤ºä¾‹

### å®Œæ•´çš„ç”Ÿæˆå’ŒéªŒè¯æµç¨‹

```bash
# 1. ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼ˆå¯ç”¨å¹¶è¡Œå¤„ç†ï¼‰
go run main.go -mode=generate -db=../../city.free.ipdb -output=./output/ -parallel

# 2. éªŒè¯ç”Ÿæˆçš„é…ç½®æ–‡ä»¶
go run main.go -mode=validate -db=../../city.free.ipdb

# 3. éªŒè¯ç‰¹å®šé…ç½®æ–‡ä»¶å¹¶å¢åŠ é‡‡æ ·æ•°é‡
go run main.go -mode=validate -db=../../city.free.ipdb -ipv4=./output/bird_v4.conf -samples=10
```

### è¾“å‡ºç¤ºä¾‹

#### ç”Ÿæˆæ¨¡å¼è¾“å‡º

```
=== ç”ŸæˆBirdé…ç½®æ¨¡å¼ ===
æ•°æ®åº“: ../../city.free.ipdb
è¾“å‡ºç›®å½•: ./output/
å¹¶è¡Œæ¨¡å¼: å¯ç”¨ (8ä¸ªCPUæ ¸å¿ƒ)

æ­£åœ¨åŠ è½½IPDBæ•°æ®åº“...
æ•°æ®åº“ä¿¡æ¯:
  æ„å»ºæ—¶é—´: 1640995200
  IPç‰ˆæœ¬: 3 (IPv4) (IPv6)
  èŠ‚ç‚¹æ•°é‡: 1234567
  å­—æ®µ: [country_name region_name city_name]

æ­£åœ¨æå–IPèŒƒå›´...
åŸå§‹æ•°æ®: 50000ä¸ªIPv4èŒƒå›´, 20000ä¸ªIPv6èŒƒå›´

æ­£åœ¨è¿‡æ»¤IPèŒƒå›´ï¼ˆæ’é™¤ä¸­å›½å¤§é™†å’Œç§æœ‰åœ°å€ï¼‰...
IPv4ç»Ÿè®¡ä¿¡æ¯:
  æ€»èŒƒå›´æ•°: 50000
  ä¸­å›½å¤§é™†(å·²è¿‡æ»¤): 25000
  ç§æœ‰åœ°å€(å·²è¿‡æ»¤): 1000
  é¦™æ¸¯(ä¿ç•™): 100
  æ¾³é—¨(ä¿ç•™): 10
  å°æ¹¾(ä¿ç•™): 50
  å…¶ä»–åœ°åŒº(ä¿ç•™): 23840
  æœ€ç»ˆä¿ç•™: 24000ä¸ªIPv4èŒƒå›´

æ­£åœ¨åˆå¹¶ç›¸é‚»IPæ®µ...
åˆå¹¶å: 15000ä¸ªIPv4æ®µ, 8000ä¸ªIPv6æ®µ

æ­£åœ¨ç”ŸæˆBirdé…ç½®...
âœ… ç”Ÿæˆå®Œæˆï¼
é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ:
  - ./output/bird_v4.conf (15000ä¸ªIPv4ç½‘æ®µ)
  - ./output/bird_v6.conf (8000ä¸ªIPv6ç½‘æ®µ)
ä½¿ç”¨äº† 8 ä¸ªCPUæ ¸å¿ƒè¿›è¡Œå¹¶è¡Œè¿‡æ»¤å¤„ç†
```

#### éªŒè¯æ¨¡å¼è¾“å‡º

```
=== éªŒè¯Birdé…ç½®æ¨¡å¼ ===
æ•°æ®åº“: ../../city.free.ipdb
é‡‡æ ·æ•°é‡: 5

æ­£åœ¨éªŒè¯ IPv4 é…ç½®: ./output/bird_v4.conf
  å‘ç° 15000 ä¸ªCIDRæ¡ç›®
å¼€å§‹éªŒè¯ 15000 ä¸ªCIDRï¼Œæ¯ä¸ªCIDRé‡‡æ · 5 ä¸ªIPåœ°å€...
è¿›åº¦: 0/15000 (0.0%)
è¿›åº¦: 1000/15000 (6.7%)
...
âœ… IPv4 é…ç½®éªŒè¯é€šè¿‡
--------------------------------------------------------------------------------
æ­£åœ¨éªŒè¯ IPv6 é…ç½®: ./output/bird_v6.conf
  å‘ç° 8000 ä¸ªCIDRæ¡ç›®
å¼€å§‹éªŒè¯ 8000 ä¸ªCIDRï¼Œæ¯ä¸ªCIDRé‡‡æ · 5 ä¸ªIPåœ°å€...
âœ… IPv6 é…ç½®éªŒè¯é€šè¿‡
--------------------------------------------------------------------------------

ğŸ‰ æ‰€æœ‰é…ç½®æ–‡ä»¶éªŒè¯é€šè¿‡ï¼
```

## æ³¨æ„äº‹é¡¹

1. ç¡®ä¿IPDBæ•°æ®åº“æ–‡ä»¶è·¯å¾„æ­£ç¡®ä¸”æ–‡ä»¶å­˜åœ¨
2. ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ä¼šæ’é™¤ä¸­å›½å¤§é™†IPåœ°å€ï¼Œä½†ä¿ç•™é¦™æ¸¯ã€æ¾³é—¨ã€å°æ¹¾çš„IP
3. å¹¶è¡Œå¤„ç†å¯ä»¥æ˜¾è‘—æé«˜å¤§æ•°æ®é›†çš„å¤„ç†é€Ÿåº¦ï¼Œä½†ä¼šæ¶ˆè€—æ›´å¤šCPUèµ„æº
4. éªŒè¯è¿‡ç¨‹ä¸­ä¼šå¯¹æ¯ä¸ªCIDRè¿›è¡Œé‡‡æ ·æ£€æŸ¥ï¼Œé‡‡æ ·æ•°é‡è¶Šå¤§éªŒè¯è¶Šå‡†ç¡®ä½†è€—æ—¶è¶Šé•¿
5. é»˜è®¤è¾“å‡ºç›®å½•ä¸º `./output/`ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º 